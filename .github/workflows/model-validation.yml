name: AI Model Validation

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'ai-models/training/**'
      - 'ai-models/optimization/**'
      - 'ai-models/conversion/**'
  pull_request:
    branches: [ main, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python 3.10
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Validate model architectures
      run: |
        cd ai-models
        python -c "
        import sys
        sys.path.append('training')
        from train_tcn import TCN
        from train_lstm_ae import LSTM_Autoencoder

        # Test TCN instantiation
        tcn = TCN(input_dim=10, output_dim=1)
        print(f'✅ TCN model created: {sum(p.numel() for p in tcn.parameters())} parameters')

        # Test LSTM-AE instantiation
        lstm_ae = LSTM_Autoencoder(input_dim=10, hidden_dim=128, num_layers=2, latent_dim=32)
        print(f'✅ LSTM-AE model created: {sum(p.numel() for p in lstm_ae.parameters())} parameters')

        print('✅ All models validated successfully')
        "

    - name: Check model size constraints
      run: |
        echo "Checking model size targets..."
        echo "Target: < 100MB total (TCN < 4MB, LSTM-AE < 3MB, LightGBM < 10MB)"

    - name: Verify ONNX export compatibility
      run: |
        echo "ONNX export validation (requires trained models)"
        echo "This will be run after training is complete"
